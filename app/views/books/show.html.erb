<% content_for :title, @book.title %>

<div class="book-detail-container">
    <div class="back-navigation">
        <%= link_to books_path, class: "back-button" do %>
        ← 戻る
        <% end %>
    </div>

    <div class="book-detail-card">
        <div class="book-detail-header">
            <div class="detail-cover">
                <% if @book.cover_image_url.present? %>
                <img src="<%= @book.cover_image_url %>" alt="<%= @book.title %>" class="detail-cover-image">
                <% else %>
                <div class="detail-cover-placeholder">
                    <div class="cover-title"><%= @book.title %></div>
                    <% if @book.author.present? %>
                    <div class="cover-author"><%= @book.author %></div>
                    <% end %>
                </div>
                <% end %>
            </div>

            <div class="detail-info">
                <h1 class="detail-title"><%= @book.title %></h1>

                <div class="detail-meta">
                    <% if @book.author.present? %>
                    <div class="meta-item">
                        <span class="meta-label">著者:</span>
                        <span class="meta-value"><%= @book.author %></span>
                    </div>
                    <% end %>

                    <% if @book.publisher.present? %>
                    <div class="meta-item">
                        <span class="meta-label">出版社:</span>
                        <span class="meta-value"><%= @book.publisher %></span>
                    </div>
                    <% end %>

                    <div class="meta-item">
                        <span class="meta-label">追加日:</span>
                        <span class="meta-value"><%= @book.created_at.strftime("%Y年%m月%d日") %></span>
                    </div>
                </div>

                <% if @book.rating.present? %>
                <div class="rating-section">
                    <h3 class="section-title">評価</h3>
                    <div class="rating-stars">
                        <% @book.rating.times do %>
                        <span class="star filled">★</span>
                        <% end %>
                        <% (5 - @book.rating).times do %>
                        <span class="star empty">☆</span>
                        <% end %>
                        <span class="rating-text">(<%= @book.rating %>/5)</span>
                    </div>
                </div>
                <% end %>

                <div class="detail-actions">
                    <%= link_to "編集", edit_book_path(@book), class: "action-button primary" %>
                    <%= button_to "削除", @book, method: :delete, 
              data: { turbo_confirm: "本当に削除しますか？" }, 
              class: "action-button danger" %>
                </div>
            </div>
        </div>

        <% if @book.memo.present? %>
        <div class="memo-section">
            <h3 class="section-title">メモ・感想</h3>
            <div class="memo-content">
                <%= simple_format(@book.memo) %>
            </div>
        </div>
        <% end %>

        <div class="related-section">
            <h3 class="section-title">最近追加した本</h3>
            <% recent_books = current_user.books.recent.limit(4).where.not(id: @book.id) %>

            <% if recent_books.any? %>
            <div class="related-books-grid">
                <% recent_books.each do |book| %>
                <div class="related-book-card" onclick="window.location.href='<%= book_path(book) %>'">
                    <div class="related-book-cover">
                        <% if book.cover_image_url.present? %>
                        <img src="<%= book.cover_image_url %>" alt="<%= book.title %>" class="related-cover-image">
                        <% else %>
                        <div class="related-cover-placeholder">
                            <%= truncate(book.title, length: 25) %>
                        </div>
                        <% end %>
                    </div>
                    <div class="related-book-info">
                        <h4 class="related-book-title"><%= truncate(book.title, length: 30) %></h4>
                        <% if book.author.present? %>
                        <p class="related-book-author"><%= truncate(book.author, length: 25) %></p>
                        <% end %>
                    </div>
                </div>
                <% end %>
            </div>
            <% else %>
            <p class="no-related">他に本がありません</p>
            <% end %>
        </div>
    </div>
</div>
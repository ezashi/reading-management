<% content_for :title, "#{@book.title} - „Ç≥„Éº„Éí„Éº„Å®Êú¨„Å®Áå´" %>

<div class="book-detail-page">
    <div class="back-navigation">
        <%= link_to books_path, class: "back-button" do %>
        <span class="back-icon">‚Üê</span>
        Êàª„Çã
        <% end %>
    </div>

    <div class="book-detail-card">
        <div class="book-detail-header">
            <div class="book-detail-cover">
                <% if @book.cover_image_url.present? %>
                <img src="<%= @book.cover_image_url %>" alt="<%= @book.title %>" class="detail-cover-image">
                <% else %>
                <div class="detail-cover-placeholder">
                    <span class="detail-cover-icon">üìñ</span>
                    <div class="detail-cover-title"><%= @book.title %></div>
                    <% if @book.author.present? %>
                    <div class="detail-cover-author"><%= @book.author %></div>
                    <% end %>
                </div>
                <% end %>
            </div>

            <div class="book-detail-info">
                <h1 class="detail-title"><%= @book.title %></h1>

                <div class="detail-meta">
                    <% if @book.author.present? %>
                    <div class="meta-item">
                        <span class="meta-icon">‚úçÔ∏è</span>
                        <span class="meta-label">ËëóËÄÖ:</span>
                        <span class="meta-value"><%= @book.author %></span>
                    </div>
                    <% end %>

                    <% if @book.publisher.present? %>
                    <div class="meta-item">
                        <span class="meta-icon">üè¢</span>
                        <span class="meta-label">Âá∫ÁâàÁ§æ:</span>
                        <span class="meta-value"><%= @book.publisher %></span>
                    </div>
                    <% end %>

                    <div class="meta-item">
                        <span class="meta-icon">üìÖ</span>
                        <span class="meta-label">ËøΩÂä†Êó•:</span>
                        <span class="meta-value"><%= @book.created_at.strftime("%YÂπ¥%mÊúà%dÊó•") %></span>
                    </div>
                </div>

                <% if @book.rating.present? %>
                <div class="rating-section">
                    <h3 class="section-title">Ë©ï‰æ°</h3>
                    <div class="large-star-rating">
                        <% @book.rating.times do %>
                        <span class="star filled">‚òÖ</span>
                        <% end %>
                        <% (5 - @book.rating).times do %>
                        <span class="star empty">‚òÜ</span>
                        <% end %>
                        <span class="rating-text">(<%= @book.rating %>/5)</span>
                    </div>
                </div>
                <% end %>

                <div class="detail-actions">
                    <%= link_to "Á∑®ÈõÜ", edit_book_path(@book), class: "action-button primary" %>
                    <%= button_to "ÂâäÈô§", @book, method: :delete, 
                        confirm: "Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü", 
                        class: "action-button danger" %>
                </div>
            </div>
        </div>

        <% if @book.memo.present? %>
        <div class="memo-section">
            <h3 class="section-title">
                <span class="section-icon">üìù</span>
                „É°„É¢„ÉªÊÑüÊÉ≥
            </h3>
            <div class="memo-content">
                <%= simple_format(@book.memo) %>
            </div>
        </div>
        <% end %>

        <div class="related-books-section">
            <h3 class="section-title">
                <span class="section-icon">üìö</span>
                ÊúÄËøëËøΩÂä†„Åó„ÅüÊú¨
            </h3>
            <% recent_books = current_user.books.recent.limit(4).where.not(id: @book.id) %>

            <% if recent_books.any? %>
            <div class="related-books-grid">
                <% recent_books.each do |book| %>
                <div class="related-book-card" onclick="window.location.href='<%= book_path(book) %>'">
                    <div class="related-book-cover">
                        <% if book.cover_image_url.present? %>
                        <img src="<%= book.cover_image_url %>" alt="<%= book.title %>" class="related-cover-image">
                        <% else %>
                        <div class="related-cover-placeholder">
                            <span class="related-cover-icon">üìñ</span>
                            <div class="related-cover-title"><%= truncate(book.title, length: 25) %></div>
                        </div>
                        <% end %>
                    </div>
                    <div class="related-book-info">
                        <h4 class="related-book-title"><%= truncate(book.title, length: 30) %></h4>
                        <% if book.author.present? %>
                        <p class="related-book-author"><%= truncate(book.author, length: 25) %></p>
                        <% end %>
                    </div>
                </div>
                <% end %>
            </div>
            <% else %>
            <p class="no-related-books">‰ªñ„Å´Êú¨„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
            <% end %>
        </div>
    </div>
</div>
<% content_for :title, @book.title %>

<div class="book-detail">
    <!-- 戻るボタン -->
    <div style="margin-bottom: 1rem;">
        <%= link_to books_path, class: "btn btn-secondary" do %>
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
        </svg>
        戻る
        <% end %>
    </div>

    <div class="book-detail-header">
        <!-- 表紙画像 -->
        <div class="book-detail-cover <%= 'has-image' if @book.cover_image_url.present? %>">
            <% if @book.cover_image_url.present? %>
            <img src="<%= @book.cover_image_url %>" alt="<%= @book.title %>">
            <% else %>
            <div style="color: white; text-align: center;">
                <div style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">
                    <%= @book.title %>
                </div>
                <% if @book.author.present? %>
                <div style="font-size: 0.875rem; opacity: 0.9;">
                    <%= @book.author %>
                </div>
                <% end %>
            </div>
            <% end %>
        </div>

        <!-- 本の情報 -->
        <div class="book-detail-info">
            <h1 class="book-detail-title"><%= @book.title %></h1>

            <div class="book-detail-meta">
                <% if @book.author.present? %>
                <div class="book-detail-meta-item">
                    <span class="book-detail-meta-label">著者:</span>
                    <%= @book.author %>
                </div>
                <% end %>

                <% if @book.publisher.present? %>
                <div class="book-detail-meta-item">
                    <span class="book-detail-meta-label">出版社:</span>
                    <%= @book.publisher %>
                </div>
                <% end %>

                <div class="book-detail-meta-item">
                    <span class="book-detail-meta-label">追加日:</span>
                    <%= @book.created_at.strftime("%Y年%m月%d日") %>
                </div>
            </div>

            <!-- 評価 -->
            <% if @book.rating.present? %>
            <div class="book-detail-section">
                <h3 class="book-detail-section-title">評価</h3>
                <div class="star-rating" style="font-size: 1.5rem;">
                    <% @book.rating.times do %>
                    <span class="star">★</span>
                    <% end %>
                    <% (5 - @book.rating).times do %>
                    <span class="star empty">☆</span>
                    <% end %>
                    <span style="margin-left: 0.5rem; font-size: 1rem; color: #6b7280;">(<%= @book.rating %>/5)</span>
                </div>
            </div>
            <% end %>

            <!-- アクションボタン -->
            <div class="book-detail-actions">
                <%= link_to "編集", edit_book_path(@book), class: "btn btn-primary" %>
                <%= button_to "削除", @book, method: :delete, 
                    confirm: "本当に削除しますか？", 
                    class: "btn btn-danger" %>
            </div>
        </div>
    </div>

    <!-- メモ・感想 -->
    <% if @book.memo.present? %>
    <div class="book-detail-section">
        <h3 class="book-detail-section-title">メモ・感想</h3>
        <div class="book-detail-memo">
            <%= simple_format(@book.memo) %>
        </div>
    </div>
    <% end %>

    <!-- 最近追加した本 -->
    <div class="book-detail-section">
        <h3 class="book-detail-section-title">最近追加した本</h3>
        <% recent_books = current_user.books.recent.limit(4).where.not(id: @book.id) %>

        <% if recent_books.any? %>
        <div class="books-grid" style="grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));">
            <% recent_books.each do |book| %>
            <div class="book-card" onclick="window.location.href='<%= book_path(book) %>'">
                <div class="book-cover <%= 'has-image' if book.cover_image_url.present? %>" style="aspect-ratio: 3/4; height: 200px;">
                    <% if book.cover_image_url.present? %>
                    <img src="<%= book.cover_image_url %>" alt="<%= book.title %>">
                    <% else %>
                    <div style="color: white; text-align: center; font-size: 0.875rem;">
                        <%= truncate(book.title, length: 25) %>
                    </div>
                    <% end %>
                </div>
                <div class="book-content">
                    <h4 class="book-title" style="font-size: 0.875rem;">
                        <%= truncate(book.title, length: 30) %>
                    </h4>
                    <% if book.author.present? %>
                    <p class="book-author" style="font-size: 0.75rem;">
                        <%= truncate(book.author, length: 25) %>
                    </p>
                    <% end %>
                </div>
            </div>
            <% end %>
        </div>
        <% else %>
        <p style="color: #6b7280;">他に本がありません</p>
        <% end %>
    </div>
</div>
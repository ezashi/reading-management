<% content_for :title, "読了一覧" %>

<!-- Hero Section -->
<div class="hero">
    <h1>あなたの読書記録</h1>
    <p>読んだ本を記録して、感想やメモを保存しましょう。</p>
    <div class="hero-stats">
        <div class="hero-stat">
            <span class="hero-stat-number"><%= current_user.books.count %></span>
            <span class="hero-stat-label">読了冊数</span>
        </div>
        <div class="hero-stat">
            <span class="hero-stat-number">
                <%= current_user.books.where.not(rating: nil).average(:rating)&.round(1) || "未評価" %>
            </span>
            <span class="hero-stat-label">平均評価</span>
        </div>
        <div class="hero-stat">
            <span class="hero-stat-number">
                <%= current_user.books.where(created_at: Time.current.beginning_of_month..Time.current.end_of_month).count %>
            </span>
            <span class="hero-stat-label">今月の読了</span>
        </div>
    </div>
</div>

<!-- 検索フォーム -->
<div class="search-section">
    <%= form_with url: books_path, method: :get, local: true, class: "search-form" do |form| %>
    <div class="search-input-group">
        <svg class="search-icon" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
        </svg>
        <%= form.text_field :search, value: @search_query, placeholder: "本のタイトルで検索...", class: "search-input" %>
    </div>
    <%= form.submit "検索", class: "btn btn-primary" %>
    <% if @search_query.present? %>
    <%= link_to "クリア", books_path, class: "btn btn-secondary" %>
    <% end %>
    <% end %>
</div>

<% if @search_query.present? %>
<p style="margin-bottom: 1rem; color: #6b7280;">「<%= @search_query %>」の検索結果: <%= @books.count %>件</p>
<% end %>

<!-- 本の一覧 -->
<% if @books.any? %>
<div class="books-grid">
    <% @books.each do |book| %>
    <div class="book-card" onclick="window.location.href='<%= book_path(book) %>'">
        <div class="book-cover <%= 'has-image' if book.cover_image_url.present? %>">
            <% if book.cover_image_url.present? %>
            <img src="<%= book.cover_image_url %>" alt="<%= book.title %>">
            <% else %>
            <div>
                <div class="book-title-overlay"><%= truncate(book.title, length: 30) %></div>
                <% if book.author.present? %>
                <div class="book-author-overlay"><%= truncate(book.author, length: 20) %></div>
                <% end %>
            </div>
            <% end %>
            <% if book.rating.present? %>
            <div class="book-rating-overlay">
                <div class="star-rating">
                    <% book.rating.times do %>
                    <span class="star">★</span>
                    <% end %>
                </div>
            </div>
            <% end %>
        </div>

        <div class="book-content">
            <h3 class="book-title"><%= book.title %></h3>
            <% if book.author.present? %>
            <p class="book-author"><%= book.author %></p>
            <% end %>
            <% if book.publisher.present? %>
            <p class="book-publisher"><%= book.publisher %></p>
            <% end %>
            <% if book.memo.present? %>
            <p class="book-memo"><%= truncate(book.memo, length: 80) %></p>
            <% end %>
        </div>
    </div>
    <% end %>
</div>
<% else %>
<div class="empty-state">
    <div class="empty-state-icon">📚</div>
    <h3 class="empty-state-title">まだ本が登録されていません</h3>
    <p class="empty-state-description">最初の本を追加して、読書記録を始めましょう！</p>
    <%= link_to "本を追加", new_book_path, class: "btn btn-primary" %>
</div>
<% end %>
<% content_for :title, "読書記録" %>

<div class="library-container">
    <section class="hero-section">
        <h1 class="hero-title">あなたの読書記録</h1>
        <p class="hero-subtitle">読んだ本を記録して、感想やメモを保存しましょう。</p>

        <div class="stats-container">
            <div class="stat-card">
                <span class="stat-number"><%= current_user.books.count %></span>
                <span class="stat-label">読了冊数</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">
                    <%= current_user.books.where.not(rating: nil).average(:rating)&.round(1) || "未評価" %>
                </span>
                <span class="stat-label">平均評価</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">
                    <%= current_user.books.where(created_at: Time.current.beginning_of_month..Time.current.end_of_month).count %>
                </span>
                <span class="stat-label">今月の読了</span>
            </div>
        </div>
    </section>

    <section class="search-section">
        <%= form_with url: books_path, method: :get, local: true, class: "search-form" do |form| %>
        <div class="search-input-group">
            <%= form.text_field :search, value: @search_query, placeholder: "本のタイトルで検索", class: "search-input" %>
        </div>
        <%= form.submit "検索", class: "search-button" %>
        <% if @search_query.present? %>
        <%= link_to "クリア", books_path, class: "clear-button" %>
        <% end %>
        <% end %>
    </section>

    <% if @search_query.present? %>
    <div class="search-info">
        「<%= @search_query %>」の検索結果: <%= @books.count %>件
    </div>
    <% end %>

    <section class="books-section">
        <% if @books.any? %>
        <div class="books-grid">
            <% @books.each do |book| %>
            <div class="book-card" onclick="window.location.href='<%= book_path(book) %>'">
                <div class="book-cover">
                    <% if book.cover_image_url.present? %>
                    <img src="<%= book.cover_image_url %>" alt="<%= book.title %>" class="cover-image">
                    <% else %>
                    <div class="cover-placeholder">
                        <div class="cover-title"><%= truncate(book.title, length: 30) %></div>
                        <% if book.author.present? %>
                        <div class="cover-author"><%= truncate(book.author, length: 20) %></div>
                        <% end %>
                    </div>
                    <% end %>

                    <% if book.rating.present? %>
                    <div class="rating-badge">
                        <% book.rating.times do %>
                        <span class="star">★</span>
                        <% end %>
                    </div>
                    <% end %>
                </div>

                <div class="book-info">
                    <h3 class="book-title"><%= book.title %></h3>
                    <% if book.author.present? %>
                    <p class="book-author"><%= book.author %></p>
                    <% end %>
                    <% if book.publisher.present? %>
                    <p class="book-publisher"><%= book.publisher %></p>
                    <% end %>
                    <% if book.memo.present? %>
                    <p class="book-memo"><%= truncate(book.memo, length: 80) %></p>
                    <% end %>
                </div>
            </div>
            <% end %>
        </div>
        <% else %>
        <div class="empty-state">
            <h3 class="empty-title">まだ本が登録されていません</h3>
            <p class="empty-description">最初の本を追加して、読書記録を始めましょう！</p>
            <%= link_to "本を追加", new_book_path, class: "add-button" %>
        </div>
        <% end %>
    </section>
</div>